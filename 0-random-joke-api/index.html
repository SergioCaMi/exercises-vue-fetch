<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Chuck Norris por categoría</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@1.5.10/css/pico.min.css" />
  </head>
  <body>
    <main class="container">
      <div id="app">
        <h1>Chistes de Chuck Norris</h1>

        <label>
          Categoría:
          <select v-model="category" @change="getJoke">
            <option disabled value="">Elige una categoría</option>
            <option v-for="cat in categories" :value="cat" :key="cat">{{ cat }}</option>
          </select>
        </label>

        <input @click="getQuery" v-model="query" type="text" />
        <button :disabled="!query" @click="getQuery">Obtener coincidencias</button>
        <div v-show="joke">
          <h2>Category: {{ category }}</h2>
          <blockquote>{{ joke }}</blockquote>
        </div>
      </div>
    </main>

    <script>
      const { createApp, ref, onMounted } = Vue;

      createApp({
        setup() {
          const query = ref("");
          const category = ref("");
          const categories = ref([]);
          const joke = ref("");

          async function getJoke() {
            try {
              const response = await fetch(`https://api.chucknorris.io/jokes/random?category=${category.value}`);
              if (!response.ok) {
                throw new Error(`Error en la API: ${response.status}`);
              }
              const data = await response.json();
              joke.value = data.value;
            } catch (error) {
              console.error(error);
            }
          }

          async function getQuery() {
            try {
              const response = await fetch(`https://api.chucknorris.io/jokes/search?query=${query.value}`);
              if (!response.ok) {
                throw new Error(`Error en la API: ${response.status}`);
              }
              const data = await response.json();
              const random = Math.floor(Math.random() * data.result.length);
              joke.value = data.result[random].value;
              category.value = data.result[random].categories.join("");
            } catch (error) {
              console.error(error);
            }
          }

          onMounted(async () => {
            try {
              const response = await fetch(`https://api.chucknorris.io/jokes/categories`);
              if (!response.ok) {
                throw new Error(`Error en la API: ${response.status}`);
              }
              const data = await response.json();
              console.log(data);
              categories.value = data;
            } catch (error) {
              console.error(error);
            }
          });

          return { category, joke, getJoke, categories, query, getQuery };
        },
      }).mount("#app");
    </script>
  </body>
</html>
